# Сервис уведомлений

Сервис управления рассылками, API администрирования и получения статистики.

### Описание

• Реализован Mock-сервис для отправки сообщений.\
• Реализованы методы создания новой рассылки, просмотра созданных и получения статистики по выполненным рассылкам;\
• Реализован сам сервис отправки уведомлений на внешнее API.

## Mock-сервис

Принимает запросы на отправку сообщений в сторону клиентов.

Реализована аутентификация с использованием JWT.
Для демонстрации работы токен доступа задан в коде сервиса.

## Сервис для контроля рассылок

### Модели

Сущность "рассылка" имеет атрибуты:

• уникальный id рассылки;<br>
• дата и время запуска рассылки;\
• текст сообщения для доставки клиенту;\
• фильтр свойств клиентов, на которых должна быть произведена рассылка (код мобильного оператора, тег);\
• дата и время окончания рассылки: если по каким-то причинам не успели разослать все сообщения - никакие сообщения клиентам после этого времени доставляться не должны.

Сущность "клиент" имеет атрибуты:

• уникальный id клиента;\
• номер телефона клиента в формате 7XXXXXXXXXX (X - цифра от 0 до 9);\
• код мобильного оператора;\
• тег (произвольная метка);\
• часовой пояс.

Сущность "сообщение" имеет атрибуты:

• уникальный id сообщения;\
• дата и время создания (отправки);\
• статус отправки;\
• id рассылки;\
• id клиента.


### Методы API

• Добавление нового клиента в справочник со всеми его атрибутами;\
• Обновление данных атрибутов клиента;\
• Удаление клиента из справочника;\
• Добавление новой рассылки со всеми её атрибутами;\
• Получение общей статистики по созданным рассылкам и количеству отправленных сообщений по ним с группировкой по статусам;\
• Получение детальной статистики отправленных сообщений по конкретной рассылке;\
• Обновление атрибутов рассылки;\
• Удаление рассылки;\
• Обработка активных рассылок и отправки сообщений клиентам;

### Логика рассылки

• После создания новой рассылки, если текущее время больше времени начала и меньше времени окончания - должны быть выбраны из справочника все клиенты, которые подходят под значения фильтра, указанного в этой рассылке и запущена отправка для всех этих клиентов;\
• Если создаётся рассылка с временем старта в будущем - отправка стартует автоматически по наступлению этого времени без дополнительных действий со стороны пользователя системы;\
• По ходу отправки сообщений собирается статистика по каждому сообщению для последующего формирования отчётов;\
• Mock-сервис, может долго обрабатывать запрос, отвечать некорректными данными, на какое-то время вообще не принимать запросы. Необходимо реализована корректная обработка ошибок. Проблемы с внешним сервисом не влияют на стабильность работы сервиса рассылок.

## Функционал проекта

1.	Тестирование кода;
2.	[WIP] *Автоматическая сборка/тестирование с помощью GitLab CI*;
3.	docker-compose для запуска всех сервисов проекта одной командой;
4.	[WIP] *Конфигурационные файлы (deployment, ingress) для запуска проекта в kubernetes и описать как их применить к работающему кластеру*;
5.	По адресу /docs/ доступна документация Swagger UI и в нём отображалось описание разработанного API;
6.	Реализован администраторский Web UI для управления рассылками и получения статистики по отправленным сообщениям;
7.	Обеспечить интеграцию с внешним OAuth2 сервисом авторизации для административного интерфейса;
8.	[WIP] *Дополнительный сервис, который раз в сутки отправляет статистику по обработанным рассылкам на email*;
9.	[WIP] *Отдача метрик в формате prometheus и задокументировать эндпоинты и экспортируемые метрики*;
10.	[WIP] *Дополнительная бизнес-логика: добавить в сущность "рассылка" поле "временной интервал", в котором можно задать промежуток времени для отправки сообщения клиентам с учётом их локального времени*;
11.	Подробное логирование на всех этапах обработки запросов:\
    11.1 id рассылки - все логи по конкретной рассылке, запросы на api и внешние запросы на отправку конкретных сообщений;\
    11.2 id сообщения - по конкретному сообщению: все запросы и ответы от внешнего сервиса, вся обработка конкретного сообщения;\
    11.3 id клиента - любые операции, которые связаны с конкретным клиентом: добавление/редактирование/отправка сообщения и т.д.